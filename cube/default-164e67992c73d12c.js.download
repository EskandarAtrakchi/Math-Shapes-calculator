!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="752a6a33-ebd2-47ad-b229-b4ce227ac1d5",e._sentryDebugIdIdentifier="sentry-dbid-752a6a33-ebd2-47ad-b229-b4ce227ac1d5")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[691],{44843:function(e,t,a){Promise.resolve().then(a.bind(a,33177)),Promise.resolve().then(a.bind(a,61153))},59264:function(e,t,a){"use strict";a.d(t,{A:function(){return r}});let r=(0,a(85922).k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",17)},33177:function(e,t,a){"use strict";a.d(t,{SidebarView:function(){return eC}});var r=a(37821),l=a(58078),n=a(25260),s=a(39565),i=a(26262),o=a(14233),d=a(74703),c=a(27624),u=a(75380),x=a(17363),m=a(59264),h=a(11696);function f(e,t){return(0,h.l)(a=>{"public"===e.visibility?a.pathname=b(e,t):a.pathname="/c/".concat(e.site_id),a.searchParams.set("b",e.id)})}function b(e,t){let a="/@".concat(t,"/").concat(e.slug);return"profile"===e.slug&&(a="/@".concat(t)),a}var g=a(17344),p=a(61153);let v=new Intl.DateTimeFormat("en",{year:"numeric",month:"long",day:"numeric"});function y(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function k(e,t){let a=new Date(t);return a.setDate(a.getDate()-1),e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear()}var j=a(35764),N=a(78781),w=a(12306),C=a(60665),D=a(57893),_=a(82125),E=a(32159),S=a(51146),T=a(53644);let q=e=>{let{id:t,className:a="",...n}=e,s=(0,l.useId)();return(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{type:"checkbox",className:"sr-only",id:null!=t?t:s,...n}),(0,r.jsx)("label",{htmlFor:null!=t?t:s,className:"\n          flex-none w-10 h-6 bg-gray-400 [:checked+&]:bg-blue-500\n          rounded-full relative appearance-none\n          cursor-pointer transition-colors duration-200\n          before:block before:w-[18px] before:h-[18px] before:bg-white before:rounded-full\n          before:m-[3px] before:relative before:transition-transform before:duration-200\n          [:checked+&]:before:translate-x-4\n          [:disabled+&]:opacity-50 [:disabled+&]:pointer-events-none\n          ".concat(a,"\n        ")})]})};var Z=a(77391);function P(e,t){return t=t.replace(/-$/g,""),(e.slice(0,50-t.length)+t).replace(/--+/g,"-")}let F=T.z.object({id:T.z.string(),title:T.z.string().min(1)}).and(T.z.object({visibility:T.z.literal("private").optional().default("private")}).or(T.z.object({visibility:T.z.literal("public"),slug:T.z.string().min(3).max(50).regex(/^[a-zA-Z0-9-]+$/,"Invalid slug")})));function L(e){null==e||e.dispatchEvent(new SubmitEvent("submit",{cancelable:!0,bubbles:!0}))}let O=e=>{let{className:t="",...a}=e;return(0,r.jsx)("label",{className:"text-sm font-semibold block mb-1 dark:text-neutral-100 ".concat(t),...a})},A=e=>{let{className:t="",...a}=e;return(0,r.jsx)("div",{className:"flex flex-col gap-1 ".concat(t),...a})},I=e=>{let{className:t,...a}=e;return(0,r.jsx)("input",{className:"\n        border border-gray-200 dark:border-neutral-700 rounded-md\n        dark:bg-neutral-800 dark:text-white\n        px-2 w-full text-sm\n        h-8\n        aria-invalid:border-red-500\n        ".concat(t,"\n      "),...a})},M=function(e){var t;let{className:a,bookmark:n,username:i,formRef:d,formElementRef:m}=e,{data:h}=(0,x.S7)(),g=(0,l.useMemo)(()=>h||[],[h]),p=(0,c.Wo)(),v=(0,c.Iq)(),y=n.site_id===v,k=(0,x.CQ)(),[j,T]=(0,w.cI)({onValidate(e){let{formData:t}=e;return(0,D.P)(t,{schema:F})},defaultValue:n,shouldValidate:"onInput",onSubmit(e,t){let{formData:a}=t;e.preventDefault();let r=F.parse(Object.fromEntries(a.entries()));k.mutateAsync({...r,id:n.id})}});j&&(d.current=j);let M=(0,l.useMemo)(()=>(function(e,t){let a=e.title.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/--+/g,"-").replace(/^-|-$/g,"").slice(0,50),r=a.replace(/-\d+$/,"");if(!t.some(t=>t.id!==e.id&&a===t.slug))return a;let l=1;for(;t.find(e=>e.slug===P(r,"-".concat(l)));)l++;return P(r,"-".concat(l))})(n,g),[g,n]),Q=(null==p?void 0:p.title.trim())!==(null===(t=T.title.value)||void 0===t?void 0:t.trim()),R=M!==n.slug,[K,B]=(0,l.useState)(Q),[z,$]=(0,l.useState)(R);K!==Q&&B(Q),z!==R&&$(R);let U=(0,x.LP)();return(0,r.jsxs)("form",{autoComplete:"off",className:a,ref:m,onKeyDown:e=>{if(e.defaultPrevented)return},...(0,C.si)(j),children:[(0,r.jsxs)("div",{className:"flex flex-1 p-2 items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm font-semibold px-2 dark:text-neutral-100",children:"Edit Bookmark"}),(0,r.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,r.jsx)(N.u,{content:"Delete Bookmark",children:(0,r.jsx)("button",{role:"checkbox",tabIndex:-1,"aria-label":"delete bookmark","aria-checked":y,className:"\n                pointer-events-auto\n                w-5 h-5\n                flex items-center justify-center rounded-sm\n                disabled:opacity-50\n                hover:bg-gray-200\n                dark:hover:bg-neutral-700\n              ",onClick:async()=>{await U.mutateAsync(n.id)},children:(0,r.jsx)(_.Z,{className:"w-4 h-4\n                stroke-red-500\n                dark:stroke-teal-200\n            "})})}),(0,r.jsx)(N.u,{content:y?"Updated!":"Update bookmark to current page",children:(0,r.jsx)("button",{disabled:!v||(0,u.kM)(v)||y,role:"checkbox","aria-label":"update bookmark","aria-checked":y,className:"\n                pointer-events-auto\n                w-5 h-5\n                flex items-center justify-center rounded-sm\n                [&:not(:aria-checked)]:bg-gray-100\n                [&:not(:aria-checked)&:hover]:bg-gray-200\n                [&:not(:aria-checked)&:disabled]:opacity-50\n                group\n              ",onClick:async()=>{v&&(await k.mutateAsync({id:n.id,site_id:v}),(0,Z.Me)(n.id))},children:(0,r.jsx)(s.Z,{className:" w-4 h-4 dark:text-neutral-200 group-aria-checked:stroke-yellow-400 group-aria-checked:fill-yellow-400 dark:group-aria-checked:stroke-sky-400 dark:group-aria-checked:fill-sky-400 "})})})]})]}),(0,r.jsx)("hr",{className:"botder border-t border-gray-200 dark:border-neutral-700"}),(0,r.jsx)("input",{type:"hidden",name:"id",value:n.id}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,r.jsxs)(A,{children:[(0,r.jsx)(O,{htmlFor:T.title.id,children:"Title"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(I,{className:K?"pr-6":"",onChange:e=>{B(e.currentTarget.value.trim()!==(null==p?void 0:p.title.trim()))},onBlur:e=>{var t;e.currentTarget.value=e.currentTarget.value.trim(),e.currentTarget.value!==(null===(t=n.title)||void 0===t?void 0:t.trim())&&j.valid&&L(m.current)},...(0,C.TC)(T.title,{type:"text"})}),K&&(null==p?void 0:p.title)&&v===n.site_id?(0,r.jsxs)("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2",onClick:()=>{m.current.elements.namedItem("title").value=p.title.trim(),B(!1),j.valid&&L(m.current)},children:[(0,r.jsx)(E.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Reset title to site title"})]}):null]}),T.title.errors?(0,r.jsx)("div",{className:"text-sm text-red-600",children:T.title.errors.join(", ")}):null]}),(0,r.jsxs)(A,{children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(O,{className:"mb-1",htmlFor:T.visibility.id,children:"Publish"}),(0,r.jsx)(q,{onChange:e=>{if(e.target.checked){let e=m.current.elements.namedItem("slug");e.value||(e.value=M,$(!1))}j.validate(),j.valid&&L(m.current)},...(0,C.TC)(T.visibility,{type:"checkbox",value:"public"})})]}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-neutral-400",children:"Makes this bookmark visible to everyone with the link configured below."}),T.visibility.errors]}),(0,r.jsxs)(A,{className:"public"===T.visibility.value||"public"===n.visibility?"":"opacity-50 pointer-events-none",children:[(0,r.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,r.jsx)(O,{htmlFor:T.slug.id,children:"Link"}),(0,r.jsx)("div",{className:"flex gap-4 items-center",children:"public"===n.visibility&&(0,r.jsxs)("a",{href:"".concat(window.location.origin).concat(b(n,i)),className:"text-sm flex gap-1 items-center text-blue-500",onClick:e=>{e.altKey||e.ctrlKey||e.metaKey||0!==e.button||(e.preventDefault(),navigator.clipboard.writeText("".concat(window.location.origin).concat(b(n,i))))},children:[(0,r.jsx)(S.Z,{className:"w-4 h-4"}),"Copy Link"]})})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(I,{readOnly:"public"!==T.visibility.value&&"public"!==n.visibility,placeholder:M,className:z?"pr-6":"",onChange:e=>{(function(e,t){let a=e.selectionStart,r="";for(let l=0;l<e.value.length&&r.length<t.maxLength;l++)t.mask.test(e.value[l])?r+=e.value[l]:a&&l<a&&a--;e.value=r,a&&e.setSelectionRange(a,a)})(e.currentTarget,{mask:/[a-zA-Z0-9-]/,maxLength:50}),$(e.currentTarget.value!==M)},onBlur:e=>{e.currentTarget.value!==n.slug&&j.valid&&L(m.current)},...(0,C.TC)(T.slug,{type:"text"})}),z&&("public"===T.visibility.value||"public"===n.visibility)?(0,r.jsxs)("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2",onClick:e=>{m.current.elements.namedItem("slug").value=M,$(!1),j.validate(),j.valid&&L(m.current)},children:[(0,r.jsx)(E.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Reset link"})]}):null]}),(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)(o.default,{href:f(n,i),className:"text-gray-500 [a&]:text-blue-500 text-xs flex items-center gap-0.5 truncate",children:(0,r.jsxs)("div",{className:"truncate",children:["websim.ai",b(n,i)||"public"!==n.visibility&&M]})})}),T.slug.errors?(0,r.jsx)("div",{className:"text-sm text-red-600",children:T.slug.errors.join(", ")}):null]}),(0,r.jsx)("button",{className:"sr-only",children:"Save"})]})]})};var Q=a(64722),R=a(90168),K=a(84578),B=a.n(K),z=a(4387),$=a(87202);let U=e=>{let{bookmark:t,profile:a}=e,n=(0,c.Iq)()===t.site_id,{ref:s,width:i}=(0,d.Z)(),u=(0,l.useMemo)(()=>f(t,a.username),[t,a]),x=(0,l.useContext)(g.Ec),m=(0,Z.ye)()===t.id,h=(0,R.useRouter)(),{attributes:p,listeners:v,setNodeRef:y,isDragging:k,transform:j}=(0,$.O1)({id:"bookmarkList".concat(t.site_id),data:{id:t.site_id,source:"bookmarkList"}});return z.ux.Transform.toString(j),(0,l.createElement)("li",{ref:y,...p,...v,key:t.id,className:"flex group",children:[(0,r.jsxs)(o.default,{href:u,className:"\n          min-w-0\n          flex-1 flex flex-col gap-1 p-2\n          bg-gray-100 rounded-lg\n          dark:bg-neutral-800\n          aria-selected:ring-2 aria-selected:ring-blue-300\n        ","aria-current":n?"page":void 0,"aria-selected":m?"true":"false",onClick:e=>{e.preventDefault(),h.push(u),B()()&&(0,Z.nP)(!1)},children:[(0,r.jsx)("div",{className:"truncate text-sm",style:{paddingRight:i},children:t.title}),"public"===t.visibility?(0,r.jsx)("div",{className:"text-gray-500 dark:text-neutral-500 text-xs flex items-center gap-0.5 truncate",children:(0,r.jsxs)("div",{className:"truncate",children:["websim.ai",b(t,a.username)]})}):null]}),(0,r.jsx)("div",{className:"w-0 flex justify-end",children:(0,r.jsx)("div",{ref:s,className:"flex gap-2 p-2 pointer-events-none ".concat(a.id===(null==x?void 0:x.id)?"":"hidden"),children:(0,r.jsx)(V,{bookmark:t,profile:a})})})]})},V=e=>{let{bookmark:t,profile:a}=e,s=(0,l.useContext)(Q.fP),i=(0,Z.fW)()===t.id,o=(0,l.useRef)(null),d=(0,l.useRef)(null);return B()()?(0,r.jsxs)(N.Vq.Root,{open:i,onOpenChange:e=>{e?(0,Z.YD)(t.id):(0,Z.YD)("")},children:[(0,r.jsx)(N.Vq.Trigger,{"aria-label":"edit bookmark",className:"\n              pointer-events-auto\n              w-5 h-5\n              flex items-center justify-center rounded-md\n              bg-blue-100 text-blue-600 hover:bg-blue-200\n            ",onClick:()=>{s("open_persist")},children:(0,r.jsx)("button",{children:(0,r.jsx)(n.Z,{className:"w-4 h-4"})})}),(0,r.jsx)(N.Vq.Content,{className:"p-0 dark:bg-neutral-900",children:(0,r.jsx)(M,{className:"flex flex-col inset-0",bookmark:t,username:a.username,formElementRef:d,formRef:o},t.id)})]}):(0,r.jsxs)(j.fC,{modal:!0,open:i,onOpenChange:e=>{e?(0,Z.YD)(t.id):(0,Z.YD)("")},children:[(0,r.jsx)(j.xz,{asChild:!0,"aria-label":"edit bookmark",className:"\n            opacity-0\n            group-hover:opacity-100\n            pointer-events-auto\n            w-5 h-5\n            flex items-center justify-center rounded-md\n            bg-blue-100 text-blue-600 hover:bg-blue-200\n          ",onClick:()=>{s("open_persist")},children:(0,r.jsx)("button",{children:(0,r.jsx)(n.Z,{className:"w-4 h-4"})})}),(0,r.jsx)(j.h_,{children:(0,r.jsxs)(j.VY,{className:"w-96",side:"right",sideOffset:30,onPointerDownOutside:e=>{let t=o.current;t&&t.dirty&&(t.validate(),t.valid&&L(d.current))},children:[(0,r.jsx)(j.Eh,{className:"fill-gray-300 dark:fill-neutral-900"}),(0,r.jsx)(M,{className:" flex flex-col rounded-lg bg-gray-100 dark:bg-neutral-900 ring-1 ring-gray-200/50 dark:ring-neutral-50/20 shadow-lg bg-clip-padding ",bookmark:t,username:a.username,formElementRef:d,formRef:o},t.id)]})})]})},Y=e=>{var t;let{bookmarks:a,profile:n,currentBookmarkId:o}=e,d=(0,l.useContext)(g.Ec),h=(0,c.Wo)(),[f]=(0,l.useState)(()=>new Date),b=a.reduce((e,t)=>{let a;let r=new Date(t.updated_at);return e[a=y(r,f)?"Today":k(r,f)?"Yesterday":r.getDate()===f.getDate()-2?"2 days ago":r.getDate()===f.getDate()-3?"3 days ago":v.format(r)]||(e[a]=[]),e[a].push(t),e},{}),{mutateAsync:j}=(0,x.qM)(),w=(0,l.useContext)(p.Oq);return(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2 px-4 pb-2 absolute inset-0 overflow-y-auto ",children:[0===a.length&&(null==d?void 0:d.id)!==n.id&&(0,r.jsxs)("div",{className:"pt-12 text-center text-gray-500 text-sm",children:["@",n.username," has no public bookmarks."]}),0===a.length&&(null==d?void 0:d.id)===n.id&&(null===(t=w.userFilter)||void 0===t?void 0:t.username)===n.username&&(0,r.jsxs)("div",{className:" pt-12 text-center text-gray-500 text-sm dark:text-neutral-400 ",children:["No bookmarks yet! Click the"," ",(0,r.jsx)(s.Z,{className:"w-4 h-4 inline","aria-label":"add bookmark"})," ","button to save a bookmark"]}),Object.entries(b).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-neutral-400 sticky top-0 px-2 -mx-2 bg-white dark:bg-neutral-900",children:t}),(0,r.jsx)("ul",{className:"flex flex-col gap-2",children:a.map(e=>(0,r.jsx)(U,{bookmark:e,profile:n},e.id))})]},t)})]}),(null==d?void 0:d.id)===n.id&&(0,r.jsx)("div",{className:"absolute top-0 right-2",children:(0,r.jsx)(N.u,{content:"Add Bookmark",children:(0,r.jsx)("button",{disabled:!(null==h?void 0:h.id)||!(null==h?void 0:h.title)||(0,u.kM)(null==h?void 0:h.id),className:"w-6 h-6 flex items-center justify-center rounded-full bg-blue-500 hover:bg-blue-400 text-white","aria-label":"add bookmark",onClick:async()=>{if((null==h?void 0:h.id)&&(null==h?void 0:h.title)){let e=(0,m.A)();await j({site_id:null==h?void 0:h.id,title:null==h?void 0:h.title,id:e})}},children:(0,r.jsx)(i.Z,{className:"w-4 h-4"})})})})]})};var W=a(17713),G=a(64816),J=a(82366);let H=e=>{var t;let{currentBookmarkId:a,onSetCurrentBookmarkId:n}=e,s=(0,l.useContext)(p.Ev);(0,l.useContext)(g.Ec);let{data:i}=(0,x.S7)();(null!=i?i:[]).find(e=>e.id===a);let o=(0,l.useContext)(p.Q),d=(0,l.useContext)(p.sY),c=d.trim(),u=(0,l.useContext)(p.Oq),m=(null!==(t=u.textFilter)&&void 0!==t?t:"").trim(),h=(0,l.useMemo)(()=>(null!=i?i:[]).filter(e=>(0,J.R)(u,s,e)),[i,u,s]);return(0,r.jsx)("div",{className:"flex-1 flex flex-col gap-4 bg-white dark:bg-neutral-900 pt-4",children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex flex-col px-4",children:(0,r.jsxs)("div",{className:"relative flex",children:[(0,r.jsx)(W.Z,{className:"absolute top-3 left-3 w-5 h-5 text-gray-500 dark:text-neutral-500"}),(0,r.jsx)("input",{type:"text",placeholder:"Search bookmarks","aria-label":"search bookmarks",className:" flex-1 h-11 pr-10 pl-10 text-sm rounded-lg border border-gray-200 dark:border-neutral-700 bg-gray-100 dark:bg-neutral-800 text-gray-800 dark:text-white ",value:d,onChange:e=>o(e.target.value),onBlur:()=>{o(c)},onKeyDown:e=>{e.defaultPrevented||"Escape"!==e.key||(e.preventDefault(),o(""))}}),""===m?null:(0,r.jsxs)("button",{"aria-label":"clear search",onClick:()=>o(""),className:"absolute top-2.5 right-2.5 w-6 h-6 flex items-center justify-center hover:bg-gray-100 rounded-full",children:[(0,r.jsx)(G.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"sr-only",children:"Clear search"})]})]})}),s&&(0,r.jsx)(Y,{bookmarks:h,profile:s,currentBookmarkId:a})]})})};var X=a(98448);function ee(){let[e,t]=(0,l.useState)(""),{data:a,error:n}=(0,X.k)();return n?(0,r.jsx)("div",{children:"Error retrieving history"}):(0,r.jsxs)("div",{className:"flex-1 flex flex-col gap-4 bg-white dark:bg-neutral-900",children:[(0,r.jsx)(et,{filterText:e,setFilterText:t}),(0,r.jsx)(ea,{data:null!=a?a:[],filterText:e})]})}function et(e){let{filterText:t,setFilterText:a}=e;return(0,r.jsx)("div",{className:"flex flex-col px-4 pt-4",children:(0,r.jsxs)("div",{className:"relative flex",children:[(0,r.jsx)(W.Z,{className:"absolute top-3 left-3 w-5 h-5 text-gray-500 dark:text-neutral-500"}),(0,r.jsx)("input",{type:"text",placeholder:"Search history","aria-label":"search history",className:" flex-1 h-11 pr-10 pl-10 text-sm rounded-lg border border-gray-200 dark:border-neutral-700 bg-gray-100 dark:bg-neutral-800 text-gray-800 dark:text-white ",value:t,onChange:e=>a(e.target.value),onKeyDown:e=>{e.defaultPrevented||"Escape"!==e.key||(e.preventDefault(),a(""))}}),""===t?null:(0,r.jsxs)("button",{"aria-label":"clear search",onClick:()=>a(""),className:"absolute top-2.5 right-2.5 w-6 h-6 flex items-center justify-center hover:bg-gray-100 rounded-full",children:[(0,r.jsx)(G.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"sr-only",children:"Clear search"})]})]})})}function ea(e){let{data:t,filterText:a}=e,l=(null!=t?t:[]).filter(e=>{var t,r;return(null===(t=e.url)||void 0===t?void 0:t.toLowerCase().includes(a.toLowerCase()))||(null===(r=e.title)||void 0===r?void 0:r.toLowerCase().includes(a.toLowerCase()))}),n=new Date,s=l.reduce((e,t)=>{let a;let r=new Date(t.created_at);return e[a=y(r,n)?"Today":k(r,n)?"Yesterday":r.getDate()===n.getDate()-2?"2 days ago":r.getDate()===n.getDate()-3?"3 days ago":v.format(r)]||(e[a]=[]),e[a].push(t),e},{});return(0,r.jsx)("div",{className:"relative flex-1",children:(0,r.jsx)("div",{className:"absolute inset-0 overflow-y-auto flex flex-col gap-2 px-4 pb-2",children:Object.entries(s).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-neutral-400 sticky top-0 px-2 -mx-2 pb-1 bg-white dark:bg-neutral-900",children:t}),a.map(e=>(0,r.jsx)(er,{site:e},e.id))]},t)})})})}function er(e){let{site:t}=e,a=(0,h.l)(e=>{e.pathname="/c/".concat(t.id)}),l="eval"!==t.method?t.command:t.url,n=(0,R.useRouter)();return(0,r.jsx)("li",{className:"flex group",children:(0,r.jsxs)(o.default,{href:a,className:"\n          min-w-0\n          flex-1 flex flex-col gap-1 p-2\n          bg-gray-100 rounded-lg\n          dark:bg-neutral-800\n          group-hover:opacity-70\n          aria-selected:ring-2 aria-selected:ring-blue-300\n          [span&]:opacity-50 [span&]:pointer-events-none\n        ",onClick:e=>{e.preventDefault(),n.push(a),B()()&&(0,Z.nP)(!1)},children:[(0,r.jsx)("div",{className:"flex flex-row gap-4 text-xs truncate",children:t.title}),l!==t.url&&(0,r.jsx)("div",{className:"flex flex-row gap-4 text-xs truncate",children:l}),(0,r.jsx)("div",{className:"flex flex-row gap-4 text-xs text-gray-500 dark:text-neutral-500 whitespace-pre-line break-all",children:t.url})]})},t.id)}var el=a(56164),en=a(34714),es=a(59406),ei=a(65607),eo=a(23224),ed=a(75005),ec=a(82813),eu=a(22577),ex=a(9799),em=a(7268),eh=a(77362),ef=a(56942);function eb(){let[e,t]=(0,l.useState)(!1),[a,n]=(0,l.useState)("/default_avatar.png"),[s,i]=(0,l.useState)("/default_avatar.png"),[o,d]=(0,l.useState)(""),[c,u]=(0,l.useState)("");return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/profile",{method:"GET",headers:{"Content-Type":"application/json"}}),t=await e.json();if(t.error){console.error("Error fetching profile:",t.error.message);return}n((null==t?void 0:t.avatar_url)||"/default_avatar.png"),i((null==t?void 0:t.avatar_url)||"/default_avatar.png"),d(t.username),u(t.username)}catch(e){console.error("Error fetching profile:",e)}})()},[]),(0,r.jsxs)(N.Vq.Root,{open:e,onOpenChange:t,children:[(0,r.jsx)(N.Vq.Trigger,{children:(0,r.jsx)("button",{className:"relative p-2",children:(0,r.jsx)("img",{src:s,alt:"User Avatar",className:"w-6 h-6 rounded-full border border-1 border-white dark:border-neutral-600",onError:e=>{"/default_avatar.png"!==e.target.src&&(e.target.src="/default_avatar.png")}})})}),(0,r.jsx)(N.Vq.Content,{maxWidth:"450px",children:(0,r.jsx)(eg,{savedAvatarUrl:a,avatarUrl:s,setAvatarUrl:i,savedUsername:o,username:c,setUsername:u,setOpen:t})})]})}function eg(e){var t;let{savedAvatarUrl:a,avatarUrl:n,setAvatarUrl:s,savedUsername:i,username:o,setUsername:d,setOpen:c}=e,u=(0,ef.Pi)(),x=(0,ef.rV)(),m=(0,ef.eP)(),[h,f]=(0,l.useState)(null!==(t=null==x?void 0:x.model)&&void 0!==t?t:"sonnet"),[b,g]=(0,l.useState)(u),p=async()=>{m({model:h}),(0,ef.Lb)(b);try{let e=n;if(n.startsWith("data:")){let t=await fetch("/api/avatar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataUrl:n})});e=(await t.json()).data.url}let t={avatar_url:e,username:o};await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),c(!1)}catch(e){console.error("Error updating profile:",e),alert("Error updating profile. Please try again.")}},v=(0,eh.useQuery)({queryKey:["username",o],queryFn:async()=>o.length<3||i===o?null:(await fetch("/api/profile/".concat(o),{method:"GET",headers:{"Content-Type":"application/json"}})).json()}),y=v.isLoading||!!v.data||!/^[a-zA-Z0-9_]{3,32}$/.test(o);return(0,r.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:e=>{e.preventDefault(),y||p()},children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"flex items-center text-2xl font-bold gap-4",children:[(0,r.jsx)(eu.Z,{className:"w-6 h-6"}),"Profile"]}),(0,r.jsx)("button",{type:"button",onClick:ev,className:"text-gray-500 text-sm py-2 hover:opacity-70 dark:text-neutral-400",children:"Logout"})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-col",children:[(0,r.jsx)("label",{htmlFor:"avatar-upload",className:"block mb-2",children:"Avatar:"}),(0,r.jsx)("img",{src:n,alt:"Avatar",className:"w-20 h-20 rounded-full mb-2"}),(0,r.jsx)("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){let e=new FileReader;e.onload=()=>{s(e.result)},e.readAsDataURL(a)}},className:"inset-0 text-xs"})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-row justify-between items-start",children:[(0,r.jsx)("label",{htmlFor:"username",className:"block leading-10",children:"Username:"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{type:"text",id:"username",value:o,onChange:e=>d(e.target.value),minLength:3,maxLength:32,pattern:"^[a-zA-Z0-9_]{3,32}$",className:" border border-gray-300 rounded-md px-3 py-2 dark:border-neutral-700 dark:bg-neutral-800 user-invalid:border-red-500 "}),v.data?(0,r.jsxs)("div",{className:"text-xs text-red-500",children:['Username "',o,'" is already taken']}):null,(0,r.jsx)("div",{className:["text-xs",o.length<3||o.length>32?"text-red-500":"text-green-600"].join(" "),children:"Between 3 and 32 characters"}),(0,r.jsx)("div",{className:["text-xs",/^[a-zA-Z0-9_]*$/.test(o)?"text-green-600":"text-red-500"].join(" "),children:"Only letters, numbers, and underscores"})]})]}),(0,r.jsxs)("div",{className:"mb-4 flex flex-row justify-between items-center",children:[(0,r.jsx)("label",{htmlFor:"dark",className:"block",children:"Dark Mode:"}),(0,r.jsx)(q,{defaultChecked:(0,l.useMemo)(()=>document.documentElement.classList.contains("dark"),[]),onChange:e=>{let t=e.target.checked;t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),document.cookie="nosleep=".concat(t,"; path=/; max-age=").concat(2147483648-1)}})]})]}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:(0,r.jsxs)(ec.pJ,{children:[(0,r.jsxs)(ec.lG,{className:"group flex items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"flex items-center text-2xl font-bold gap-4 group-data-[open]:mb-4 mb-8",children:[(0,r.jsx)(ex.Z,{className:"w-6 h-6"}),"Settings"]}),(0,r.jsx)(em.Z,{className:"w-6 h-6 group-data-[open]:rotate-180 group-data-[open]:mb-4 mb-8"})]}),(0,r.jsx)(ec.V2,{className:"data-[open]:mb-8 mb-0",children:(0,r.jsx)(ep,{model:h,setModel:f,apiKey:b,setApiKey:g})})]})}),(0,r.jsx)("div",{className:"flex justify-between",children:(0,r.jsxs)("div",{className:"flex-1 flex justify-end",children:[(0,r.jsx)(N.Vq.Close,{children:(0,r.jsx)("button",{type:"button",className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md mr-2",onClick:()=>{d(i),s(a)},children:"Cancel"})}),(0,r.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md disabled:opacity-50",disabled:y,children:"Save Changes!"})]})})]})}function ep(e){let{model:t,setModel:a,apiKey:l,setApiKey:n}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("label",{htmlFor:"model",children:"Default Model"}),(0,r.jsxs)("select",{value:t||"",id:"model",className:"border border-gray-300 rounded-md px-3 py-2 dark:border-neutral-700 dark:bg-neutral-800",onChange:e=>{a(e.target.value)},children:[(0,r.jsx)("option",{value:"haiku",children:"Haiku"}),(0,r.jsx)("option",{value:"sonnet",children:"Sonnet (3.5)"}),(0,r.jsx)("option",{value:"opus",children:"Opus"}),(0,r.jsx)("option",{value:"gpt-4o",children:"GPT-4o"}),(0,r.jsx)("option",{value:"claude-3-sonnet",children:"Sonnet (3)"})]})]}),(0,r.jsx)("div",{className:"flex items-center justify-between mb-4"}),(0,r.jsxs)("div",{className:"flex justify-between mb-4 flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4 flex-1",children:[(0,r.jsx)("label",{htmlFor:"apiKey",children:"Custom API Key"}),(0,r.jsx)("input",{type:"text",className:"border border-gray-300 rounded-md px-3 py-2 dark:border-neutral-700 dark:bg-neutral-800",placeholder:"Optional",defaultValue:l,onChange:e=>{e.target.value?n(e.target.value):n(void 0)}})]}),(0,r.jsxs)("div",{className:"text-xs",children:["Use either an"," ",(0,r.jsx)("a",{href:"https://openrouter.ai",className:"text-blue-500 hover:text-blue-700",target:"_blank",children:"OpenRouter"})," ","or"," ",(0,r.jsx)("a",{href:"https://anthropic.com",className:"text-blue-500 hover:text-blue-700",target:"_blank",children:"Anthropic"})," ","API Key. We recommend OpenRouter as it has less rate limiting."]})]})]})}async function ev(){let e=(0,ed.e)();await e.auth.signOut(),window.location.href="/"}let ey=e=>{let{pinned:t,onPin:a,renderBookmarks:n,renderLikes:i,renderHistory:o,onClose:d,fullScreen:c}=e,u=(0,Z.Tk)(),x=(0,l.useContext)(Q.fP);return(0,r.jsxs)("div",{className:"\n      shadow-xl bg-clip-padding\n      @container flex-1 flex flex-col\n      bg-gray-100\n      dark:bg-neutral-700\n      ring-1 ring-gray-200/50 dark:ring-neutral-50/20\n      z-10\n      ".concat(c?"":"rounded-lg","\n      overflow-y-auto\n    "),onClick:()=>{B()()||x("open")},children:[(0,r.jsxs)("div",{className:"flex space-between items-end",children:[(0,r.jsxs)("div",{className:"flex flex-1 items-center flex-row gap-0 h-12",children:[(0,r.jsx)(el.T,{className:"text-xl p-4 justify-center"}),(0,r.jsx)("div",{className:"flex-0 flex h-full items-center justify-center",children:!B()()&&(0,r.jsx)("button",{onClick:()=>{t?d():a()},className:" flex-0 hover:opacity-80 rounded-lg items-center justify-center px-4 py-2 text-gray-500 bg-gray-200 mt-[3px] dark:bg-neutral-500 dark:text-neutral-100 ",children:t?(0,r.jsx)(en.Z,{className:"w-4 h-4"}):(0,r.jsx)(es.Z,{className:"w-4 h-4"})})})]}),(0,r.jsxs)("div",{className:"flex-0 flex flex-row gap-2 pr-2",children:[(0,r.jsx)("button",{className:"".concat("bookmarks"===u?"bg-white dark:bg-neutral-900":"bg-gray-200 dark:bg-neutral-800"," flex-0 rounded-lg rounded-b-none px-3 pt-2 pb-1 hover:opacity-80"),onClick:()=>(0,Z.$5)("bookmarks"),children:(0,r.jsx)(s.Z,{className:"w-5 h-5 mb-0"})}),(0,r.jsx)("button",{className:"".concat("likes"===u?"bg-white dark:bg-neutral-900":"bg-gray-200 dark:bg-neutral-800"," flex-0 rounded-lg rounded-b-none px-3 pt-2 pb-1 hover:opacity-80"),onClick:()=>(0,Z.$5)("likes"),children:(0,r.jsx)(ei.Z,{className:"w-5 h-5 mb-0"})}),(0,r.jsx)("button",{className:"".concat("history"===u?"bg-white dark:bg-neutral-900":"bg-gray-200 dark:bg-neutral-800"," flex-0 rounded-lg rounded-b-none px-3 pt-2 pb-1 hover:opacity-80"),onClick:()=>(0,Z.$5)("history"),children:(0,r.jsx)(eo.Z,{className:"w-5 h-5 mb-0"})}),(0,r.jsx)("div",{className:"flex-0 flex items-center justify-center pt-1",children:(0,r.jsx)(eb,{})})]})]}),"bookmarks"===u?n():"likes"===u?i():o()]})},ek=e=>{let{like:t}=e,a=(0,c.Iq)(),n=a===t.site_id,{ref:s,width:i}=(0,d.Z)(),u=a===t.site_id,x=(0,R.useRouter)(),{attributes:m,listeners:f,setNodeRef:b,isDragging:g,transform:p}=(0,$.O1)({id:"likeList".concat(t.site_id),data:{id:t.site_id,source:"likeList"}});z.ux.Transform.toString(p);let v=(0,h.l)(e=>{e.pathname="/c/".concat(t.site_id)});return(0,l.createElement)("li",{ref:b,...m,...f,key:t.id,className:"flex group"},(0,r.jsx)(o.default,{href:v,className:"\n          min-w-0\n          flex-1 flex flex-col gap-1 p-2\n          bg-gray-100 rounded-lg\n          dark:bg-neutral-800\n          aria-selected:ring-2 aria-selected:ring-blue-300\n        ","aria-current":n?"page":void 0,"aria-selected":u?"true":"false",onClick:e=>{e.preventDefault(),x.push(v),B()()&&(0,Z.nP)(!1)},children:(0,r.jsx)("div",{className:"truncate text-sm",style:{paddingRight:i},children:t.title||t.url})}))},ej=e=>{let{likes:t}=e,[a]=(0,l.useState)(()=>new Date),n=t.reduce((e,t)=>{let r;let l=new Date(t.created_at);return e[r=y(l,a)?"Today":k(l,a)?"Yesterday":l.getDate()===a.getDate()-2?"2 days ago":l.getDate()===a.getDate()-3?"3 days ago":v.format(l)]||(e[r]=[]),e[r].push(t),e},{});return(0,r.jsx)("div",{className:"relative flex-1",children:(0,r.jsxs)("div",{className:"flex flex-col gap-2 px-4 pb-2 absolute inset-0 overflow-y-auto ",children:[0===t.length&&(0,r.jsxs)("div",{className:" pt-12 text-center text-gray-500 text-sm dark:text-neutral-400 ",children:["No likes yet! Click the"," ",(0,r.jsx)(ei.Z,{className:"w-4 h-4 inline","aria-label":"add like"})," ","button to save a like"]}),Object.entries(n).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-neutral-400 sticky top-0 px-2 -mx-2 bg-white dark:bg-neutral-900",children:t}),(0,r.jsx)("ul",{className:"flex flex-col gap-2",children:a.map(e=>(0,r.jsx)(ek,{like:e},e.id))})]},t)})]})})},eN=()=>{let{data:e}=function(){var e;let t=(0,ed.$)(),a=(0,l.useContext)(g.Ec);return(0,eh.useQuery)({queryKey:[null!==(e=null==a?void 0:a.id)&&void 0!==e?e:"","likes"],queryFn:async()=>{var e;let r=await t.from("likes").select("id,created_at,user_id,site_id,...sites(title,url)").order("created_at",{ascending:!1}).eq("user_id",null!==(e=null==a?void 0:a.id)&&void 0!==e?e:"");if(r.error)throw r.error;return r.data},enabled:!!a})}(),[t,a]=(0,l.useState)(""),n=(0,l.useMemo)(()=>null==e?void 0:e.filter(e=>{var a,r;return(null===(a=e.title)||void 0===a?void 0:a.toLowerCase().includes(t.toLowerCase()))||(null===(r=e.url)||void 0===r?void 0:r.toLowerCase().includes(t.toLowerCase()))}),[e,t]);return(0,r.jsx)("div",{className:"flex-1 flex flex-col gap-4 bg-white dark:bg-neutral-900 pt-4",children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex flex-col px-4",children:(0,r.jsxs)("div",{className:"relative flex",children:[(0,r.jsx)(W.Z,{className:"absolute top-3 left-3 w-5 h-5 text-gray-500 dark:text-neutral-500"}),(0,r.jsx)("input",{type:"text",placeholder:"Search likes","aria-label":"search likes",className:" flex-1 h-11 pr-10 pl-10 text-sm rounded-lg border border-gray-200 dark:border-neutral-700 bg-gray-100 dark:bg-neutral-800 text-gray-800 dark:text-white ",value:t,onChange:e=>a(e.target.value),onBlur:()=>{a(t.trim())},onKeyDown:e=>{e.defaultPrevented||"Escape"!==e.key||(e.preventDefault(),a(""))}}),""===t?null:(0,r.jsxs)("button",{"aria-label":"clear search",onClick:()=>a(""),className:"absolute top-2.5 right-2.5 w-6 h-6 flex items-center justify-center hover:bg-gray-100 rounded-full",children:[(0,r.jsx)(G.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"sr-only",children:"Clear search"})]})]})}),(0,r.jsx)(ej,{likes:null!=n?n:[]})]})})};var ew=a(73164);function eC(){let e=(0,ew.O9)(),t=(0,l.useContext)(g.Ec),a=(0,Z.ye)(),n=(0,Z.Tl)(),s=(0,l.useContext)(Q.fP);return t?(0,r.jsx)(ey,{fullScreen:e,pinned:n,onPin:()=>{(0,Z.nP)(!0)},onClose:()=>{s("exited"),(0,Z.nP)(!1)},renderBookmarks:()=>(0,r.jsx)(H,{currentBookmarkId:a,onSetCurrentBookmarkId:e=>{}},"sidebar"),renderLikes:()=>(0,r.jsx)(eN,{}),renderHistory:()=>(0,r.jsx)(ee,{})}):null}},17363:function(e,t,a){"use strict";a.d(t,{CQ:function(){return x},E7:function(){return u},LP:function(){return h},S7:function(){return c},qM:function(){return m}});var r=a(75005),l=a(77362),n=a(87601),s=a(18151),i=a(58078),o=a(17344),d=a(61153);function c(){var e;let t=(0,r.$)(),a=(0,d.BO)();return(0,l.useQuery)({queryKey:[null!==(e=null==a?void 0:a.id)&&void 0!==e?e:"","bookmarks"],queryFn:async()=>{var e;let{data:r}=await t.from("bookmark").select("*").order("updated_at",{ascending:!1}).eq("owner_id",null!==(e=null==a?void 0:a.id)&&void 0!==e?e:"");return r},enabled:!!a})}function u(e){let t=(0,r.$)(),a=(0,i.useContext)(o.Ec);return(0,l.useQuery)({queryKey:["pageBookmarks",e],queryFn:async()=>{let{data:r}=await t.from("bookmark").select("*").order("updated_at",{ascending:!1}).eq("site_id",e).eq("owner_id",a.id);return r},enabled:!!e&&!!a})}function x(){let e=(0,r.$)(),t=(0,n.useQueryClient)(),a=(0,i.useContext)(o.Ec);return(0,s.useMutation)({mutationFn:async t=>{let{id:a,...r}=t,{error:l,data:n}=await e.from("bookmark").update(r).eq("id",a).select("*").single();if(l)throw l;return n},onSuccess:async e=>{if(!a)throw Error("User must be logged in to update bookmark");return t.setQueryData(["bookmark",e.id],e),t.setQueryData([a.id,"bookmarks"],t=>t?[e,...t.filter(t=>t.id!==e.id)]:[e]),t.setQueryData(["pageBookmarks",e.site_id],t=>t?[e,...t.filter(t=>t.id!==e.id)]:[e]),e}})}function m(){let e=(0,r.$)(),t=(0,n.useQueryClient)(),a=(0,i.useContext)(o.Ec);return(0,s.useMutation)({mutationFn:async t=>{let{error:a,data:r}=await e.from("bookmark").insert(t).select("*").single();if(a)throw a;return r},onSuccess:async e=>{var r;return t.setQueryData(["bookmark",e.id],e),t.setQueryData([null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"","bookmarks"],t=>t?[e,...t]:[e]),t.setQueryData(["pageBookmarks",e.site_id],t=>t?[e,...t]:[e]),e}})}function h(){let e=(0,r.$)(),t=(0,n.useQueryClient)(),a=(0,i.useContext)(o.Ec);return(0,s.useMutation)({mutationFn:async t=>{let{error:a}=await e.from("bookmark").delete().eq("id",t);if(a)throw a;return t},onSuccess:async e=>{var r;t.setQueryData(["bookmark",e],void 0),t.setQueryData([null!==(r=null==a?void 0:a.id)&&void 0!==r?r:"","bookmarks"],t=>t?t.filter(t=>t.id!==e):[]),t.setQueriesData({predicate:e=>"pageBookmarks"===e.queryKey[0]},t=>{if(t)return t.filter(t=>t.id!==e)})}})}},98448:function(e,t,a){"use strict";a.d(t,{k:function(){return d},t:function(){return o}});var r=a(75005),l=a(17344),n=a(58078),s=a(87601),i=a(77362);function o(){let e=(0,s.useQueryClient)();return(0,n.useCallback)(t=>{e.setQueryData(["history"],e=>e?[t,...e]:[t])},[e])}function d(){let e=(0,r.$)(),t=(0,n.useContext)(l.Ec);return(0,i.useQuery)({queryKey:[t.id,"history"],queryFn:async()=>{let{data:a,error:r}=await e.from("sites").select("id, title, url, method, command, created_at").eq("user_id",null==t?void 0:t.id).order("created_at",{ascending:!1});if(r)throw r;return a},enabled:!!t})}}},function(e){e.O(0,[552,71,575,433,172,866,115,362,744],function(){return e(e.s=44843)}),_N_E=e.O()}]);